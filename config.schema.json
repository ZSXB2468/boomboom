{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Game Configuration Schema",
  "description": "Configuration schema for the music guessing game",
  "type": "object",
  "required": ["game", "selection_rules", "players", "songs", "playback", "scoring", "ui"],
  "properties": {
    "game": {
      "type": "object",
      "required": ["name", "rounds", "round_end_mode"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Game name"
        },
        "rounds": {
          "type": "integer",
          "minimum": 1,
          "description": "Total number of rounds"
        },
        "round_end_mode": {
          "type": "string",
          "enum": ["fixed", "manual"],
          "description": "How each round ends"
        },
        "songs_per_round": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of songs per round (when round_end_mode is 'fixed')"
        }
      }
    },
    "selection_rules": {
      "type": "object",
      "required": ["mode", "allow_duplicates"],
      "properties": {
        "mode": {
          "type": "string",
          "enum": ["random", "sequential", "weighted"],
          "description": "Song selection mode"
        },
        "allow_duplicates": {
          "type": "boolean",
          "description": "Whether to allow duplicate songs across rounds"
        }
      }
    },
    "special_songs": {
      "type": "array",
      "description": "Special songs with fixed positions",
      "items": {
        "type": "object",
        "required": ["song_id", "round", "position"],
        "properties": {
          "song_id": {
            "type": "integer",
            "description": "ID of the song"
          },
          "round": {
            "type": "integer",
            "minimum": 1,
            "description": "Round number (1-based)"
          },
          "position": {
            "type": "integer",
            "description": "Position in the round (1-based, -1 for last)"
          }
        }
      }
    },
    "players": {
      "type": "array",
      "minItems": 1,
      "description": "List of players",
      "items": {
        "type": "object",
        "required": ["id", "name"],
        "properties": {
          "id": {
            "type": "integer",
            "description": "Unique player ID"
          },
          "name": {
            "type": "string",
            "description": "Player name"
          },
          "avatar": {
            "type": "string",
            "description": "Player avatar: can be omitted (uses first letter of name), text (up to 2 characters), or image path (URL/relative/absolute path)"
          },
          "team": {
            "type": "string",
            "description": "Team name (optional)"
          }
        }
      }
    },
    "songs": {
      "type": "array",
      "minItems": 1,
      "description": "List of songs",
      "items": {
        "type": "object",
        "required": ["id", "title", "artist", "album", "path", "cover", "score", "weight", "duration", "tags"],
        "properties": {
          "id": {
            "type": "integer",
            "description": "Unique song ID"
          },
          "title": {
            "type": "string",
            "description": "Song title"
          },
          "artist": {
            "type": "string",
            "description": "Artist name"
          },
          "album": {
            "type": "string",
            "description": "Album name"
          },
          "path": {
            "type": "string",
            "description": "Path to song file (relative, absolute, or URL)"
          },
          "cover": {
            "type": "string",
            "description": "Path to album cover image"
          },
          "score": {
            "type": "number",
            "minimum": 0,
            "description": "Base score for this song"
          },
          "weight": {
            "type": "number",
            "minimum": 0,
            "description": "Weight for weighted random selection"
          },
          "duration": {
            "type": "integer",
            "minimum": 1,
            "description": "Song duration in seconds"
          },
          "chorus_time": {
            "type": "integer",
            "minimum": 0,
            "description": "Chorus start time in seconds (optional)"
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Tags for categorization"
          },
          "is_special": {
            "type": "boolean",
            "description": "Whether this is a special song"
          }
        }
      }
    },
    "playback": {
      "type": "object",
      "required": ["clip_duration", "start_position", "fade_duration", "volume"],
      "properties": {
        "clip_duration": {
          "type": "integer",
          "description": "Playback duration in seconds (-1 for full song)"
        },
        "start_position": {
          "type": "integer",
          "description": "Start position in seconds (-1 for random)"
        },
        "fade_duration": {
          "type": "number",
          "minimum": 0,
          "description": "Fade in/out duration in seconds"
        },
        "volume": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Playback volume (0.0 - 1.0)"
        }
      }
    },
    "scoring": {
      "type": "object",
      "required": ["title_correct", "artist_correct", "album_bonus", "speed_bonus"],
      "properties": {
        "title_correct": {
          "type": "number",
          "minimum": 0,
          "description": "Score multiplier for correct title"
        },
        "artist_correct": {
          "type": "number",
          "minimum": 0,
          "description": "Score multiplier for correct artist"
        },
        "album_bonus": {
          "type": "number",
          "minimum": 0,
          "description": "Score for correct album"
        },
        "speed_bonus": {
          "type": "number",
          "minimum": 0,
          "description": "Bonus points for fast answer"
        },
        "speed_threshold": {
          "type": "integer",
          "minimum": 1,
          "description": "Time threshold for speed bonus in seconds (optional)"
        },
        "time_limit": {
          "type": "integer",
          "minimum": 1,
          "description": "Time limit for answering in seconds (optional, omit for unlimited)"
        }
      }
    },
    "ui": {
      "type": "object",
      "required": ["theme_color", "show_cover", "show_lyrics", "show_leaderboard"],
      "properties": {
        "theme_color": {
          "type": "string",
          "pattern": "^#[0-9A-Fa-f]{6}$",
          "description": "Theme color (hex format)"
        },
        "show_cover": {
          "type": "boolean",
          "description": "Whether to show album cover"
        },
        "show_lyrics": {
          "type": "boolean",
          "description": "Whether to show lyrics"
        },
        "show_leaderboard": {
          "type": "boolean",
          "description": "Whether to show leaderboard"
        },
        "background_image": {
          "type": "string",
          "description": "Path to background image (optional)"
        }
      }
    }
  }
}

